<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LaunchLib: state.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LaunchLib
   </div>
   <div id="projectbrief">An easy-to-use library to help kickstart your launchpad development.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_28e9dcee17d7ed40f76cf3c311e57a25.html">launchlib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">state.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Simple state machine handler.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="global_8h_source.html">global.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="state_8h_source.html">state.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for state.c:</div>
<div class="dyncontent">
<div class="center"><img src="state_8c__incl.png" border="0" usemap="#state_8c" alt=""/></div>
<map name="state_8c" id="state_8c">
<area shape="rect" id="node3" href="global_8h.html" title="Definitions and data structures for general use in all files." alt="" coords="331,80,397,107"/><area shape="rect" id="node19" href="state_8h.html" title="Definitions, data structues and prototypes for state machine handling." alt="" coords="511,80,573,107"/><area shape="rect" id="node17" href="config_8h.html" title="config.h" alt="" coords="555,155,621,181"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a6e06d4f4914d3d22da439a47a8fa4675"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">LocalDefaults</a> { <a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a> =0, 
<a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a> =1, 
<a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f">EXIT</a> =2
 }</td></tr>
<tr class="memdesc:a6e06d4f4914d3d22da439a47a8fa4675"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default events not enqueued by users.  <a href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">More...</a><br/></td></tr>
<tr class="separator:a6e06d4f4914d3d22da439a47a8fa4675"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae8a8cb624200dd4a51a9ec5d659b613b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_state_machine.html">StateMachine</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#ae8a8cb624200dd4a51a9ec5d659b613b">StateMachineCreate</a> (<a class="el" href="struct_transition.html">Transition</a> *rules, uint8_t t_size, <a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> state)</td></tr>
<tr class="memdesc:ae8a8cb624200dd4a51a9ec5d659b613b"><td class="mdescLeft">&#160;</td><td class="mdescRight">State machine initialization.  <a href="#ae8a8cb624200dd4a51a9ec5d659b613b"></a><br/></td></tr>
<tr class="separator:ae8a8cb624200dd4a51a9ec5d659b613b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abea5d7b7721fc928b3a4362b0c76fe03"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#abea5d7b7721fc928b3a4362b0c76fe03">StateMachinePublishEvent</a> (<a class="el" href="struct_state_machine.html">StateMachine</a> *s, uint8_t event)</td></tr>
<tr class="memdesc:abea5d7b7721fc928b3a4362b0c76fe03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a new event.  <a href="#abea5d7b7721fc928b3a4362b0c76fe03"></a><br/></td></tr>
<tr class="separator:abea5d7b7721fc928b3a4362b0c76fe03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3995ceea5be0a3ffce937a7752699f6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a3995ceea5be0a3ffce937a7752699f6d">StateMachineRun</a> (<a class="el" href="struct_state_machine.html">StateMachine</a> *s)</td></tr>
<tr class="memdesc:a3995ceea5be0a3ffce937a7752699f6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the state machine.  <a href="#a3995ceea5be0a3ffce937a7752699f6d"></a><br/></td></tr>
<tr class="separator:a3995ceea5be0a3ffce937a7752699f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Simple state machine handler. </p>
<dl class="section author"><dt>Author</dt><dd>Joe Brown </dd></dl>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">LocalDefaults</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default events not enqueued by users. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18"></a>IDLE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e"></a>ENTER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f"></a>EXIT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line">{<a class="code" href="state_8h.html#a5ab720e698e2cb8f94c83bdc6d89b31a" title="List of default events.">DEFAULT_EVENTS</a>};</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae8a8cb624200dd4a51a9ec5d659b613b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_state_machine.html">StateMachine</a> StateMachineCreate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_transition.html">Transition</a> *&#160;</td>
          <td class="paramname"><em>rules</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>t_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State machine initialization. </p>
<p>Initializes the state machine by saving a pointer to the transition rules, saving the size (so we can loop through it looking for state changes) and initially publishes and ENTER event so the first state can initialize whatever it needs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rules</td><td>Pointer to state transitions rules table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t_size</td><td>The size of the transition rules table (not accounting for <a class="el" href="struct_transition.html" title="A transition which holds a current state, an event, and the state that will be entered upon receiving...">Transition</a> struct size) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>The initial state of the state machine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event_cnt_max</td><td>The max number of events in the event queue </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the state machine struct </dd></dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="struct_state_machine.html" title="A structure that contains all information about a given state machine.">StateMachine</a> s;</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#a20e8ce6dfaf0c723d91db14208d85b3a">start</a> = 0;</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#ab71d8a0759b2795c071a8a90746dc2ef">event_cnt</a> = 0;</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#a81c58106ca31cabdb81f5bb97c7e71fd">transitions</a> = rules;</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#a1da707691c3417e78f230dd39d2ab96c">transition_table_size</a> = (t_size / <span class="keyword">sizeof</span>(<a class="code" href="struct_transition.html" title="A transition which holds a current state, an event, and the state that will be entered upon receiving...">Transition</a>));</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#af25734e675a89bf131fd25737e27811b">transition_event</a> = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;</div>
<div class="line">    s.<a class="code" href="struct_state_machine.html#a884fb7f7728ae27ce55b59f0def7e38f">state</a> = state;</div>
<div class="line">    <a class="code" href="state_8c.html#abea5d7b7721fc928b3a4362b0c76fe03" title="Queue a new event.">StateMachinePublishEvent</a>(&amp;s, <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>);</div>
<div class="line">    <span class="keywordflow">return</span> (s);</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="state_8c_ae8a8cb624200dd4a51a9ec5d659b613b_cgraph.png" border="0" usemap="#state_8c_ae8a8cb624200dd4a51a9ec5d659b613b_cgraph" alt=""/></div>
<map name="state_8c_ae8a8cb624200dd4a51a9ec5d659b613b_cgraph" id="state_8c_ae8a8cb624200dd4a51a9ec5d659b613b_cgraph">
<area shape="rect" id="node3" href="state_8c.html#abea5d7b7721fc928b3a4362b0c76fe03" title="Queue a new event." alt="" coords="195,5,373,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abea5d7b7721fc928b3a4362b0c76fe03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t StateMachinePublishEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_state_machine.html">StateMachine</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue a new event. </p>
<p>Pushes a new event in to the event queue and adjust the size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>A pointer to state machine to publish to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>The event to enqueue. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if event was queued, FAILURE otherwise </dd></dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    int8_t ret = <a class="code" href="global_8h.html#adf764cbdea00d65edcd07bb9953ad2b7aa5571864412c8275a2e18a931fddcaa6">FAILURE</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct_state_machine.html#ab71d8a0759b2795c071a8a90746dc2ef">event_cnt</a> &lt; <a class="code" href="config_8h.html#a4ca719fc38491bd0082e84b9e5dbe778">MAX_EVENT_CNT</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct_state_machine.html#a20e8ce6dfaf0c723d91db14208d85b3a">start</a> + s-&gt;<a class="code" href="struct_state_machine.html#ab71d8a0759b2795c071a8a90746dc2ef">event_cnt</a> == <a class="code" href="config_8h.html#a4ca719fc38491bd0082e84b9e5dbe778">MAX_EVENT_CNT</a>)</div>
<div class="line">        {</div>
<div class="line">            s-&gt;<a class="code" href="struct_state_machine.html#a951ec35d07f736b2d4db4a255c79d812">event_queue</a>[0] = event;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            s-&gt;<a class="code" href="struct_state_machine.html#a951ec35d07f736b2d4db4a255c79d812">event_queue</a>[s-&gt;<a class="code" href="struct_state_machine.html#a20e8ce6dfaf0c723d91db14208d85b3a">start</a> + s-&gt;<a class="code" href="struct_state_machine.html#ab71d8a0759b2795c071a8a90746dc2ef">event_cnt</a>] = event;</div>
<div class="line">        }</div>
<div class="line">        s-&gt;<a class="code" href="struct_state_machine.html#ab71d8a0759b2795c071a8a90746dc2ef">event_cnt</a>++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="state_8c_abea5d7b7721fc928b3a4362b0c76fe03_icgraph.png" border="0" usemap="#state_8c_abea5d7b7721fc928b3a4362b0c76fe03_icgraph" alt=""/></div>
<map name="state_8c_abea5d7b7721fc928b3a4362b0c76fe03_icgraph" id="state_8c_abea5d7b7721fc928b3a4362b0c76fe03_icgraph">
<area shape="rect" id="node3" href="state_8h.html#ae8a8cb624200dd4a51a9ec5d659b613b" title="State machine initialization." alt="" coords="233,5,373,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3995ceea5be0a3ffce937a7752699f6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StateMachineRun </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_state_machine.html">StateMachine</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run the state machine. </p>
<p>Checks the event queue for new events, processes the current state and modifies the state based on state transitions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>A pointer to the state machine to run </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="comment">// get the next event</span></div>
<div class="line">    uint8_t <span class="keyword">event</span> = CheckEventQueue(s);</div>
<div class="line">    <span class="comment">// run the state</span></div>
<div class="line">    (s-&gt;<a class="code" href="struct_state_machine.html#a884fb7f7728ae27ce55b59f0def7e38f">state</a>)(event);</div>
<div class="line">    <span class="comment">// check for state transitions</span></div>
<div class="line">    s-&gt;<a class="code" href="struct_state_machine.html#a884fb7f7728ae27ce55b59f0def7e38f">state</a> = LookupTransition(s, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 27 2012 18:21:58 for LaunchLib by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
