<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LaunchLib: state.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">LaunchLib
   
   </div>
   <div id="projectbrief">An easy-to-use library to help kickstart your launchpad development.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('state_8c.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">state.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Simple state machine handler.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="global_8h_source.html">global.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hardware_8h_source.html">hardware.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="state_8h_source.html">state.h</a>&quot;</code><br/>
</div>
<p><a href="state_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a6e06d4f4914d3d22da439a47a8fa4675"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">LocalDefaults</a> { <a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>, 
<a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>, 
<a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f">EXIT</a>
 }</td></tr>
<tr class="memdesc:a6e06d4f4914d3d22da439a47a8fa4675"><td class="mdescLeft">&#160;</td><td class="mdescRight">event queue (published events are stored here)  <a href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a33dc29df01532e875f3bc38f0dd3bfda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a33dc29df01532e875f3bc38f0dd3bfda">StateMachineInit</a> (<a class="el" href="struct_transition.html">Transition</a> *state_transitions, <a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> t_size)</td></tr>
<tr class="memdesc:a33dc29df01532e875f3bc38f0dd3bfda"><td class="mdescLeft">&#160;</td><td class="mdescRight">State machine initialization.  <a href="#a33dc29df01532e875f3bc38f0dd3bfda"></a><br/></td></tr>
<tr class="memitem:aed24699fb62cd4dac6111cc46be93bfb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#aed24699fb62cd4dac6111cc46be93bfb">CheckEventQueue</a> (<a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> state)</td></tr>
<tr class="memdesc:aed24699fb62cd4dac6111cc46be93bfb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the event queue for changes.  <a href="#aed24699fb62cd4dac6111cc46be93bfb"></a><br/></td></tr>
<tr class="memitem:a505b7932ed754874a9b6d8c8d5ce03fe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a505b7932ed754874a9b6d8c8d5ce03fe">QueuePeek</a> (void)</td></tr>
<tr class="memdesc:a505b7932ed754874a9b6d8c8d5ce03fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peek at the event queue to see what the next event will be.  <a href="#a505b7932ed754874a9b6d8c8d5ce03fe"></a><br/></td></tr>
<tr class="memitem:a19551ac60bc7944766db81ffac45e282"><td class="memItemLeft" align="right" valign="top"><a class="el" href="global_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a19551ac60bc7944766db81ffac45e282">StateMachinePublishEvent</a> (<a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> event)</td></tr>
<tr class="memdesc:a19551ac60bc7944766db81ffac45e282"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a new event.  <a href="#a19551ac60bc7944766db81ffac45e282"></a><br/></td></tr>
<tr class="memitem:a49030034414372bdab6cf8e469be38fe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a49030034414372bdab6cf8e469be38fe">DequeueEvent</a> (void)</td></tr>
<tr class="memdesc:a49030034414372bdab6cf8e469be38fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dequeue an event from the event queue.  <a href="#a49030034414372bdab6cf8e469be38fe"></a><br/></td></tr>
<tr class="memitem:a1cdba4fcc4f2957df1b8076501feec84"><td class="memItemLeft" align="right" valign="top"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a1cdba4fcc4f2957df1b8076501feec84">LookupTransition</a> (<a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> state, <a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> event)</td></tr>
<tr class="memdesc:a1cdba4fcc4f2957df1b8076501feec84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next state from the transition table.  <a href="#a1cdba4fcc4f2957df1b8076501feec84"></a><br/></td></tr>
<tr class="memitem:a940f2f18dae4f0f2c0fca4a02444c3d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state_8c.html#a940f2f18dae4f0f2c0fca4a02444c3d9">StateMachineRun</a> (<a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> *state)</td></tr>
<tr class="memdesc:a940f2f18dae4f0f2c0fca4a02444c3d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the state machine.  <a href="#a940f2f18dae4f0f2c0fca4a02444c3d9"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Simple state machine handler. </p>
<dl class="section author"><dt>Author:</dt><dd>Joe Brown </dd></dl>

<p>Definition in file <a class="el" href="state_8c_source.html">state.c</a>.</p>
</div><hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675">LocalDefaults</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>event queue (published events are stored here) </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18"></a>IDLE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e"></a>ENTER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f"></a>EXIT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00025">25</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{<a class="code" href="state_8h.html#a5ab720e698e2cb8f94c83bdc6d89b31a" title="List of default events.">DEFAULT_EVENTS</a>};
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aed24699fb62cd4dac6111cc46be93bfb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="el" href="state_8c.html#aed24699fb62cd4dac6111cc46be93bfb">CheckEventQueue</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check the event queue for changes. </p>
<p>If we are in the IDLE state and a state transition is going to take place (detected by using LookupTransition) we will return EXIT. If no transition will take then we simple dequeue the next event.</p>
<p>If we are currently processing an EXIT event this means the next transition in the queue will cause a state transition, so we dequeue that event and return it to the new state but save the transition_event as ENTER to force an ENTER event to be sent after the event is complete.</p>
<p>Once the transition-causing event has been processed we return an ENTER event to allow state intialization in the new state. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>The current state the state machine is in </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The event to be run by the current state </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00049">49</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> ret_event = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;

    _DINT();
    <span class="keywordflow">switch</span> (transition_event)
    {
        <span class="keywordflow">case</span> <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>:
            <span class="comment">// get the next event without dequeuing and peek at the table to see</span>
            <span class="comment">// if this event will cause a transition</span>
            <span class="keywordflow">if</span> (state != <a class="code" href="state_8c.html#a1cdba4fcc4f2957df1b8076501feec84" title="Get the next state from the transition table.">LookupTransition</a>(state, <a class="code" href="state_8c.html#a505b7932ed754874a9b6d8c8d5ce03fe" title="Peek at the event queue to see what the next event will be.">QueuePeek</a>()))
            {
                <span class="comment">// if a transition will happen, return the EXIT event</span>
                ret_event = transition_event = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f">EXIT</a>;
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">// if a transition will not happen, dequeue events normally</span>
                ret_event = <a class="code" href="state_8c.html#a49030034414372bdab6cf8e469be38fe" title="Dequeue an event from the event queue.">DequeueEvent</a>();
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>:
            <span class="comment">// return ENTER and switch transition event to IDLE</span>
            ret_event = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>;
            transition_event = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f">EXIT</a>:
            <span class="comment">// switch transition event to ENTER but return queued event</span>
            transition_event = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>;
            ret_event = <a class="code" href="state_8c.html#a49030034414372bdab6cf8e469be38fe" title="Dequeue an event from the event queue.">DequeueEvent</a>();
            <span class="keywordflow">break</span>;
    }
    _EINT();
    <span class="keywordflow">return</span> ret_event;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a49030034414372bdab6cf8e469be38fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="el" href="state_8c.html#a49030034414372bdab6cf8e469be38fe">DequeueEvent</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dequeue an event from the event queue. </p>
<p>Removes an event from the event queue and passes it to the current state. </p>
<dl class="section return"><dt>Returns:</dt><dd>The next event to tbe processed by the current state </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00109">109</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="global_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a> ret = <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;
    <span class="comment">// are there any events?</span>
    <span class="keywordflow">if</span> (size)
    {
        <span class="comment">// save the value we will return</span>
        ret = queue[start];
        <span class="comment">// adjust the start</span>
        start = (start == (<a class="code" href="hardware_8h.html#a4ca719fc38491bd0082e84b9e5dbe778">MAX_EVENT_CNT</a> - 1)) ? 0 : (start + 1);
        <span class="comment">// adjust the size</span>
        size--;
    }
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1cdba4fcc4f2957df1b8076501feec84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> <a class="el" href="state_8c.html#a1cdba4fcc4f2957df1b8076501feec84">LookupTransition</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a>&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the next state from the transition table. </p>
<p>Get the next state from the transition table based on the current state and the most recent event dequeued from the event queue. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>The current state being processed by the state machine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>The next event dequeue from the event queue </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The next state to be run based on transition rules </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00126">126</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> i = 0;
    <a class="code" href="state_8h.html#a73296dcaec5ad45548632021a1e68528" title="function pointer to a state function that accepts an event variable">State</a> ret_state = state;
    <span class="comment">// if the event is idle or enter/exit just return state)</span>
    <span class="keywordflow">if</span> (event != <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a> &amp;&amp; event != <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a> &amp;&amp; state != <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a7a10b5d68d31711288e1fe0fa17dbf4f">EXIT</a>)
    {
        <span class="comment">// if event is a new event find the transition</span>
        <span class="keywordflow">for</span>(i = 0;i &lt; transition_table_size;i++)
        {
            <span class="keywordflow">if</span> (transition_table[i].current_state == state &amp;&amp;
                transition_table[i].event_code    == event)
            {
                ret_state = transition_table[i].<a class="code" href="struct_transition.html#a9d0208a273c0ccb507ae50c2942406f3">next_state</a>;
                <span class="keywordflow">break</span>;
            }
        }
    }
    <span class="keywordflow">return</span> ret_state;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a505b7932ed754874a9b6d8c8d5ce03fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <a class="el" href="state_8c.html#a505b7932ed754874a9b6d8c8d5ce03fe">QueuePeek</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Peek at the event queue to see what the next event will be. </p>
<p>Peek at the queue without dequeueing the next item. We use this so check if a state transition will be coming so we can pass EXIT and ENTER events. </p>
<dl class="section return"><dt>Returns:</dt><dd>If there are no events in the queue, IDLE. If there is a pending event in the queue we will return it. </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00086">86</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> size ? queue[start] : <a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33dc29df01532e875f3bc38f0dd3bfda"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="state_8h.html#a33dc29df01532e875f3bc38f0dd3bfda">StateMachineInit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_transition.html">Transition</a> *&#160;</td>
          <td class="paramname"><em>state_transitions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>t_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State machine initialization. </p>
<p>Initializes the state machine by saving a pointer to the transition rules, saving the size (so we can loop through it looking for state changes) and initially publishes and ENTER event so the first state can initialize whatever it needs. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">state_transitions</td><td>Pointer to state transitions rules table </td></tr>
    <tr><td class="paramname">t_size</td><td>The size of the transition rules table (not accounting for <a class="el" href="struct_transition.html" title="A transition which holds a current state, an event, and the state that will be entered upon receievin...">Transition</a> struct size) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00038">38</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// save a pointer to the state transition table</span>
    transition_table = state_transitions;
    <span class="comment">// save it&#39;s size so we can search it</span>
    transition_table_size = (t_size / <span class="keyword">sizeof</span>(<a class="code" href="struct_transition.html" title="A transition which holds a current state, an event, and the state that will be entered upon receievin...">Transition</a>));
    <span class="comment">// enqueue an enter event to start the idle state</span>
    <a class="code" href="state_8c.html#a19551ac60bc7944766db81ffac45e282" title="Queue a new event.">StateMachinePublishEvent</a>(<a class="code" href="state_8c.html#a6e06d4f4914d3d22da439a47a8fa4675a951ab68bb8f7daafb78951107080904e">ENTER</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a19551ac60bc7944766db81ffac45e282"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="global_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a> <a class="el" href="state_8h.html#a19551ac60bc7944766db81ffac45e282">StateMachinePublishEvent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Queue a new event. </p>
<p>Pushes a new event in to the event queue and adjust the size. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>The event to enqueue. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0 if successful, -1 for failure </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00092">92</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="global_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a> ret = -1;
    <span class="comment">// event queue full?</span>
    <span class="keywordflow">if</span> (size &lt; <a class="code" href="hardware_8h.html#a4ca719fc38491bd0082e84b9e5dbe778">MAX_EVENT_CNT</a>)
    {
        <span class="comment">// add event to queue</span>
        queue[((start + size) == <a class="code" href="hardware_8h.html#a4ca719fc38491bd0082e84b9e5dbe778">MAX_EVENT_CNT</a>) ? 0 : (start + size)] = event;
        <span class="comment">// adjust the size</span>
        size++;
        <span class="comment">// return success</span>
        ret = 0;
    }
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a940f2f18dae4f0f2c0fca4a02444c3d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="state_8h.html#a940f2f18dae4f0f2c0fca4a02444c3d9">StateMachineRun</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="state_8h.html#a73296dcaec5ad45548632021a1e68528">State</a> *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run the state machine. </p>
<p>Checks the event queue for new events, processes the current state and modifies the state based on state transitions. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>A pointer to the current state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>Overwrites current state pointer with next state pointer </dd></dl>

<p>Definition at line <a class="el" href="state_8c_source.html#l00148">148</a> of file <a class="el" href="state_8c_source.html">state.c</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// get the next event</span>
    <a class="code" href="global_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> <span class="keyword">event</span> = <a class="code" href="state_8c.html#aed24699fb62cd4dac6111cc46be93bfb" title="Check the event queue for changes.">CheckEventQueue</a>(*state);
    <span class="comment">// run the state</span>
    (*state)(event);
    <span class="comment">// check for state transitions</span>
    *state = <a class="code" href="state_8c.html#a1cdba4fcc4f2957df1b8076501feec84" title="Get the next state from the transition table.">LookupTransition</a>(*state, event);
}
</pre></div>
</div>
</div>
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="state_8c.html">state.c</a>      </li>

    <li class="footer">Generated on Sun Apr 8 2012 16:56:54 for LaunchLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
