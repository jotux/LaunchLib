<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LaunchLib: schedule.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LaunchLib
   </div>
   <div id="projectbrief">An easy-to-use library to help kickstart your launchpad development.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_28e9dcee17d7ed40f76cf3c311e57a25.html">launchlib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">schedule.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Generic scheduling mechanisms.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="global_8h_source.html">global.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="schedule_8h_source.html">schedule.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hardware__init_8h_source.html">hardware_init.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for schedule.c:</div>
<div class="dyncontent">
<div class="center"><img src="schedule_8c__incl.png" border="0" usemap="#schedule_8c" alt=""/></div>
<map name="schedule_8c" id="schedule_8c">
<area shape="rect" id="node3" href="global_8h.html" title="Definitions and data structures for general use in all files." alt="" coords="331,80,397,107"/><area shape="rect" id="node17" href="config_8h.html" title="config.h" alt="" coords="555,155,621,181"/><area shape="rect" id="node19" href="schedule_8h.html" title="Definitions, data structues and prototypes for generic scheduling mechanisms." alt="" coords="571,80,656,107"/><area shape="rect" id="node21" href="hardware__init_8h.html" title="Macros to init hardware." alt="" coords="680,80,789,107"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_callout_event.html">CalloutEvent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Congiruation for callout which holds the function pointer and next time it will run.  <a href="struct_callout_event.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a831beafd7d2f091490b059bd308eaf2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#a831beafd7d2f091490b059bd308eaf2c">SCHEDULE_VECTOR</a>&#160;&#160;&#160;WDT_VECTOR</td></tr>
<tr class="separator:a831beafd7d2f091490b059bd308eaf2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7cca52889a75eb770ca7a70cbf47a858"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#a7cca52889a75eb770ca7a70cbf47a858">ScheduleTimerInit</a> (void)</td></tr>
<tr class="memdesc:a7cca52889a75eb770ca7a70cbf47a858"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the schedule timer used to check callouts and callbacks.  <a href="#a7cca52889a75eb770ca7a70cbf47a858"></a><br/></td></tr>
<tr class="separator:a7cca52889a75eb770ca7a70cbf47a858"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d4536e2d00f3020b327fe6c3b46a6c6"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#a8d4536e2d00f3020b327fe6c3b46a6c6">CallbackRegister</a> (<a class="el" href="schedule_8h.html#a52acb0158eef8a6a72957b6605c95353">CallbackFn</a> func, uint32_t run_time)</td></tr>
<tr class="memdesc:a8d4536e2d00f3020b327fe6c3b46a6c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a callback to the store for periodic execution.  <a href="#a8d4536e2d00f3020b327fe6c3b46a6c6"></a><br/></td></tr>
<tr class="separator:a8d4536e2d00f3020b327fe6c3b46a6c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7bea75865706649e73af9520b966629"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#ab7bea75865706649e73af9520b966629">CallbackMode</a> (<a class="el" href="schedule_8h.html#a52acb0158eef8a6a72957b6605c95353">CallbackFn</a> func, enum <a class="el" href="schedule_8h.html#a86e22603a3d57c440c9ef54acb11b617">ScheduleMode</a> mode)</td></tr>
<tr class="memdesc:ab7bea75865706649e73af9520b966629"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable a function callback.  <a href="#ab7bea75865706649e73af9520b966629"></a><br/></td></tr>
<tr class="separator:ab7bea75865706649e73af9520b966629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7515403c92ea393f971b6688aa5b87b"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#ac7515403c92ea393f971b6688aa5b87b">CalloutRegister</a> (<a class="el" href="schedule_8h.html#a1c02760ad032ffd6ebc2b0a01d474f0d">CalloutFn</a> func, uint32_t run_time)</td></tr>
<tr class="memdesc:ac7515403c92ea393f971b6688aa5b87b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a callout to the store for one-time execution.  <a href="#ac7515403c92ea393f971b6688aa5b87b"></a><br/></td></tr>
<tr class="separator:ac7515403c92ea393f971b6688aa5b87b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab55f47631849be4bd604d9aec2ffb390"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#ab55f47631849be4bd604d9aec2ffb390">CalloutCancel</a> (<a class="el" href="schedule_8h.html#a1c02760ad032ffd6ebc2b0a01d474f0d">CalloutFn</a> func)</td></tr>
<tr class="memdesc:ab55f47631849be4bd604d9aec2ffb390"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable a function callout before it has run.  <a href="#ab55f47631849be4bd604d9aec2ffb390"></a><br/></td></tr>
<tr class="separator:ab55f47631849be4bd604d9aec2ffb390"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a51b353488bb101e21bd86a67b750b5d4"><td class="memItemLeft" align="right" valign="top">volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#a51b353488bb101e21bd86a67b750b5d4">g_now</a> = 0</td></tr>
<tr class="memdesc:a51b353488bb101e21bd86a67b750b5d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">global time accessible by everyone  <a href="#a51b353488bb101e21bd86a67b750b5d4"></a><br/></td></tr>
<tr class="separator:a51b353488bb101e21bd86a67b750b5d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6105e756d37068c9b1ff56ccb388797"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="schedule_8c.html#ac6105e756d37068c9b1ff56ccb388797">g_timing_multiplier</a> = 0</td></tr>
<tr class="memdesc:ac6105e756d37068c9b1ff56ccb388797"><td class="mdescLeft">&#160;</td><td class="mdescRight">timing multiplier to allow regular interval scheduling with varying clock speeds  <a href="#ac6105e756d37068c9b1ff56ccb388797"></a><br/></td></tr>
<tr class="separator:ac6105e756d37068c9b1ff56ccb388797"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Generic scheduling mechanisms. </p>
<dl class="section author"><dt>Author</dt><dd>Joe Brown </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a831beafd7d2f091490b059bd308eaf2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCHEDULE_VECTOR&#160;&#160;&#160;WDT_VECTOR</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab7bea75865706649e73af9520b966629"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CallbackMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="schedule_8h.html#a52acb0158eef8a6a72957b6605c95353">CallbackFn</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="schedule_8h.html#a86e22603a3d57c440c9ef54acb11b617">ScheduleMode</a>&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable or disable a function callback. </p>
<p>Search the callback store for the specified function and enable or disable it based on the mode passed in. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>callback function to configure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mode</td><td>enabled or disabled </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    uint8_t i = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0;i &lt; event_count;i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (func == callback_store[i].func)</div>
<div class="line">        {</div>
<div class="line">            callback_store[i].<a class="code" href="struct_callback_event.html#a81a7031abfd335275a5acf475d7ef766">enabled</a> = mode;</div>
<div class="line">            <span class="keywordflow">if</span> (mode)</div>
<div class="line">            {</div>
<div class="line">                callback_store[i].<a class="code" href="struct_callback_event.html#a1b21ad88610b96246ed05e4b7a645817">next_run_time</a> = <a class="code" href="schedule_8c.html#a51b353488bb101e21bd86a67b750b5d4" title="global time accessible by everyone">g_now</a> +</div>
<div class="line">                                                  callback_store[i].<a class="code" href="struct_callback_event.html#a787c60dfca79b1561e9cbd020561e5e4">run_time</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="schedule_8c_ab7bea75865706649e73af9520b966629_icgraph.png" border="0" usemap="#schedule_8c_ab7bea75865706649e73af9520b966629_icgraph" alt=""/></div>
<map name="schedule_8c_ab7bea75865706649e73af9520b966629_icgraph" id="schedule_8c_ab7bea75865706649e73af9520b966629_icgraph">
<area shape="rect" id="node3" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="main" alt="" coords="157,5,208,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8d4536e2d00f3020b327fe6c3b46a6c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t CallbackRegister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="schedule_8h.html#a52acb0158eef8a6a72957b6605c95353">CallbackFn</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>run_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a callback to the store for periodic execution. </p>
<p>Take the function and run time and store them in the callback store. Intially set the enabled flag to false to keep us from accidentally calling a function before it is expected. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>function pointer registered to callback </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">run_time</td><td>period on which to run the callback function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if callback registered successfully, FAILURE otherwise </dd></dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (event_count &lt; <span class="keyword">sizeof</span>(callback_store)/<span class="keyword">sizeof</span>(<a class="code" href="schedule_8h.html#a52acb0158eef8a6a72957b6605c95353" title="function pointer to a callback">CallbackFn</a>))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Callbacks are initialized disabled</span></div>
<div class="line">        callback_store[event_count].<a class="code" href="struct_callback_event.html#a81a7031abfd335275a5acf475d7ef766">enabled</a>       = <a class="code" href="global_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;</div>
<div class="line">        callback_store[event_count].<a class="code" href="struct_callback_event.html#a5ee86bf0b23d84d0d119ee6dac811695">func</a>          = func;</div>
<div class="line">        callback_store[event_count].<a class="code" href="struct_callback_event.html#a787c60dfca79b1561e9cbd020561e5e4">run_time</a>      = run_time - 1;</div>
<div class="line">        callback_store[event_count].<a class="code" href="struct_callback_event.html#a1b21ad88610b96246ed05e4b7a645817">next_run_time</a> = <a class="code" href="schedule_8c.html#a51b353488bb101e21bd86a67b750b5d4" title="global time accessible by everyone">g_now</a> + run_time;</div>
<div class="line">        event_count++;</div>
<div class="line">        <span class="keywordflow">return</span> (<a class="code" href="global_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code" href="global_8h.html#adf764cbdea00d65edcd07bb9953ad2b7aa5571864412c8275a2e18a931fddcaa6">FAILURE</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="schedule_8c_a8d4536e2d00f3020b327fe6c3b46a6c6_icgraph.png" border="0" usemap="#schedule_8c_a8d4536e2d00f3020b327fe6c3b46a6c6_icgraph" alt=""/></div>
<map name="schedule_8c_a8d4536e2d00f3020b327fe6c3b46a6c6_icgraph" id="schedule_8c_a8d4536e2d00f3020b327fe6c3b46a6c6_icgraph">
<area shape="rect" id="node3" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="main" alt="" coords="173,5,224,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab55f47631849be4bd604d9aec2ffb390"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CalloutCancel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="schedule_8h.html#a1c02760ad032ffd6ebc2b0a01d474f0d">CalloutFn</a>&#160;</td>
          <td class="paramname"><em>func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable a function callout before it has run. </p>
<p>Search the callout store for the specific function. If we find it go clear the map to indicate the slot is vacant. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>function pointer to search for and cancel </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    uint8_t i = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0;i &lt; <a class="code" href="config_8h.html#a633e51fd220983033afe28f559b9243f">MAX_CALLOUT_CNT</a>;i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// find the slot</span></div>
<div class="line">        <span class="keywordflow">if</span> (callout_store[i].func == func)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// clear</span></div>
<div class="line">            callout_map &amp;= ~<a class="code" href="global_8h.html#a11643f271076024c395a93800b3d9546">_BV</a>(i);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac7515403c92ea393f971b6688aa5b87b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t CalloutRegister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="schedule_8h.html#a1c02760ad032ffd6ebc2b0a01d474f0d">CalloutFn</a>&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>run_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a callout to the store for one-time execution. </p>
<p>Take the function and run time and store them in the callout store. For callouts we maintain a "map" of callouts in a bit array. When we store a new function we find an empty slot (0 in the bit array) and set it. That bit corresponds to the index of the callout store the function pointer is stored at. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>function pointer registered to callout slot </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">run_time</td><td>Specific time in which to run the function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS if callback registered successfully, FAILURE otherwise </dd></dl>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="comment">// event queue full?</span></div>
<div class="line">    <span class="keywordflow">if</span> (get_callout_map_size() != <a class="code" href="config_8h.html#a633e51fd220983033afe28f559b9243f">MAX_CALLOUT_CNT</a>)</div>
<div class="line">    {</div>
<div class="line">        uint8_t i = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0;i &lt; <a class="code" href="config_8h.html#a633e51fd220983033afe28f559b9243f">MAX_CALLOUT_CNT</a>;i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// find the first open slot</span></div>
<div class="line">            <span class="keywordflow">if</span> (!(callout_map &amp; <a class="code" href="global_8h.html#a11643f271076024c395a93800b3d9546">_BV</a>(i)))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// claim the slot</span></div>
<div class="line">                callout_map |= <a class="code" href="global_8h.html#a11643f271076024c395a93800b3d9546">_BV</a>(i);</div>
<div class="line">                <span class="comment">// save our data</span></div>
<div class="line">                callout_store[i].<a class="code" href="struct_callout_event.html#a0e689c61e79a9b51ed4dfcd11c390bb1">func</a> = func;</div>
<div class="line">                callout_store[i].<a class="code" href="struct_callout_event.html#a040c82f3961da0defdbb57979c68283d">run_time</a> = <a class="code" href="schedule_8c.html#a51b353488bb101e21bd86a67b750b5d4" title="global time accessible by everyone">g_now</a> + run_time;</div>
<div class="line">                <span class="comment">// return success</span></div>
<div class="line">                <span class="keywordflow">return</span> (<a class="code" href="global_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code" href="global_8h.html#adf764cbdea00d65edcd07bb9953ad2b7aa5571864412c8275a2e18a931fddcaa6">FAILURE</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7cca52889a75eb770ca7a70cbf47a858"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ScheduleTimerInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the schedule timer used to check callouts and callbacks. </p>
<p>Configure the watchdog timer to periodically wake up and service the scheduler tasks. We currently use a 0.5 ms period and save the multiplier to g_timing_multiplier. This is used in the definition of _MILLISECOND to give flexible timing. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="comment">// divide the mclk by 512</span></div>
<div class="line">    WDTCTL = WDT_MDLY_0_5;</div>
<div class="line">    <span class="comment">// calculate the multiplier (number of clks to get to 1ms)</span></div>
<div class="line">    <a class="code" href="schedule_8c.html#ac6105e756d37068c9b1ff56ccb388797" title="timing multiplier to allow regular interval scheduling with varying clock speeds">g_timing_multiplier</a> = (<a class="code" href="clock_8c.html#a359bc99c5de9e253ca290fdde403d7b0">g_clock_speed</a> / 1000000) * 2;</div>
<div class="line">    WDT_INT_ENABLE |= WDTIE;    <span class="comment">// Enable WDT interrupt</span></div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="schedule_8c_a7cca52889a75eb770ca7a70cbf47a858_icgraph.png" border="0" usemap="#schedule_8c_a7cca52889a75eb770ca7a70cbf47a858_icgraph" alt=""/></div>
<map name="schedule_8c_a7cca52889a75eb770ca7a70cbf47a858_icgraph" id="schedule_8c_a7cca52889a75eb770ca7a70cbf47a858_icgraph">
<area shape="rect" id="node3" href="clock_8h.html#afa002073487babf6a0336e5aa9a9f624" title="Configure the clocks for use." alt="" coords="179,5,269,32"/><area shape="rect" id="node5" href="main_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="main" alt="" coords="317,31,368,57"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a51b353488bb101e21bd86a67b750b5d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t g_now = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>global time accessible by everyone </p>

</div>
</div>
<a class="anchor" id="ac6105e756d37068c9b1ff56ccb388797"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t g_timing_multiplier = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>timing multiplier to allow regular interval scheduling with varying clock speeds </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 9 2013 23:13:47 for LaunchLib by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
